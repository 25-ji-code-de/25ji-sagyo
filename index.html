<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" id="viewportMeta" content="width=device-width, initial-scale=1">
  <title>『25时、Nightcord见。』成员们的 24 小时工作日常</title>
  <meta name="description" content="『25时、Nightcord见。』成员们的 24 小时工作日常 — 沉浸式作业陪伴：番茄钟、CD 播放器、世界时钟与音频可视化等实用工具。" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <div id="videoLoader" class="video-loader">
      <div class="loader-spinner"></div>
      <div class="loader-text">视频加载中...</div>
    </div>
    <video id="video" autoplay muted playsinline preload="metadata" crossorigin="anonymous"></video>
      <div id="overlay">
        <div id="info">
          Time (<span id="tzLabel">Local</span>): <span id="localTime">--:--:--</span>
        </div>

        <!-- Live Status & Broadcast Widget -->
        <div id="liveStatus" class="live-status-container">
          <div class="live-stat-item online-users" title="当前在线人数">
            <span class="live-dot"></span>
            <span class="stat-value">--</span>
            <span class="stat-label">在线</span>
          </div>
          <div class="live-stat-item broadcast-msg">
            <span class="broadcast-icon">📢</span>
            <div class="broadcast-text-wrapper">
              <span class="broadcast-text">正在连接 Nightcord...</span>
            </div>
          </div>
        </div>

        <div id="controls" role="toolbar" aria-label="Video controls">
          <button id="muteBtn" aria-pressed="true" title="Mute / Unmute">🔊</button>
          <input id="volumeSlider" type="range" min="0" max="1" step="0.05" value="1" aria-label="Volume" />
          <button id="audioProcessBtn" aria-pressed="false" title="音频处理（限幅+降低人声）">🎚️</button>
          <button id="fullscreenBtn" title="Fullscreen">Fullscreen</button>
          <button id="tzToggleBtn" title="Toggle timezone">Toggle TZ</button>
          <button id="pomodoroBtn" title="Pomodoro Timer">🍅</button>
          <button id="cdPlayerBtn" title="CD Player">💿</button>
          <button id="settingsBtn" title="设置">⚙️</button>
        </div>

        <!-- Pomodoro Timer Panel -->
        <div id="pomodoroPanel" class="hidden">
          <div class="pomodoro-header">
            <span>番茄钟 & 世界时钟</span>
            <div class="header-controls">
              <button id="toggleClockWidget" class="toggle-btn" title="显示/隐藏时钟">🕐</button>
              <button id="pomodoroCloseBtn" class="close-btn" title="关闭">✕</button>
            </div>
          </div>
          
          <!-- Main Content: Left-Right Layout -->
          <div class="pomodoro-main-content">
            <!-- Left Side: World Clock Section -->
            <div class="world-clock-section" id="worldClockSection">
              <div class="clock-item main-clock">
                <div class="clock-label">本地时间</div>
                <div class="clock-time-large">
                  <span class="time-hours" id="localHours">00</span>
                  <span class="time-separator">:</span>
                  <span class="time-minutes" id="localMinutes">00</span>
                  <span class="time-separator">:</span>
                  <span class="time-seconds" id="localSeconds">00</span>
                  <span class="time-milliseconds" id="localMilliseconds">.000</span>
                </div>
                <div class="clock-date" id="localDate">2025年12月7日 星期六</div>
              </div>
              
              <div class="world-clocks-grid">
                <div class="clock-item-small">
                  <select class="clock-select" id="clock1Select" title="选择时区"></select>
                  <div class="clock-time-small" id="clock1Container">
                    <span class="time-hms" id="clock1Time">00:00:00</span>
                  </div>
                </div>
                <div class="clock-item-small">
                  <select class="clock-select" id="clock2Select" title="选择时区"></select>
                  <div class="clock-time-small" id="clock2Container">
                    <span class="time-hms" id="clock2Time">00:00:00</span>
                  </div>
                </div>
                <div class="clock-item-small">
                  <select class="clock-select" id="clock3Select" title="选择时区"></select>
                  <div class="clock-time-small" id="clock3Container">
                    <span class="time-hms" id="clock3Time">00:00:00</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Side: Pomodoro Timer -->
            <div class="pomodoro-body">
              <div id="pomodoroDisplay" class="pomodoro-display">25:00</div>
              <div class="pomodoro-status">准备工作</div>
              <div class="pomodoro-controls">
                <button id="pomodoroStartBtn" class="pomodoro-btn primary">开始</button>
                <button id="pomodoroPauseBtn" class="pomodoro-btn" disabled>暂停</button>
                <button id="pomodoroResetBtn" class="pomodoro-btn">重置</button>
              </div>
              <div class="pomodoro-settings">
                <div class="setting-item">
                  <label for="workDuration">工作时长 (分钟):</label>
                  <input type="number" id="workDuration" min="1" max="60" value="25" />
                </div>
                <div class="setting-item">
                  <label for="shortBreak">短休息 (分钟):</label>
                  <input type="number" id="shortBreak" min="1" max="30" value="5" />
                </div>
                <div class="setting-item">
                  <label for="longBreak">长休息 (分钟):</label>
                  <input type="number" id="longBreak" min="1" max="60" value="15" />
                </div>
                <div class="setting-item">
                  <label for="pomodoroRound">工作轮次:</label>
                  <span id="pomodoroRound">0 / 4</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Panel -->
      <div id="chatPanel" class="hidden side-panel">
        <div class="panel-header">
          <span>💬 消息记录</span>
          <button id="chatCloseBtn" class="close-btn" title="关闭">✕</button>
        </div>
        <div class="chat-messages" id="chatMessages">
          <div class="chat-message system">
            <span class="time">--:--</span>
            <span class="content">欢迎来到 Nightcord 作业空间。</span>
          </div>
        </div>
        <div class="chat-input-area">
          <input type="text" id="chatInput" placeholder="发送消息..." />
          <button id="chatSendBtn">发送</button>
        </div>
      </div>

      <!-- CD Player Panel -->
      <div id="cdPlayerPanel" class="hidden">
        <div class="cd-player-header">
          <span>🎵 SEKAI 留声机</span>
          <div class="header-controls">
            <button id="toggleVisualization" class="toggle-btn" title="显示/隐藏音频可视化">🌀</button>
            <button id="cdPlayerCloseBtn" class="close-btn" title="关闭">✕</button>
          </div>
        </div>
        
        <div class="cd-player-body">
          <!-- Music List -->
          <div class="music-list-section">
            <!-- Category Sidebar -->
            <div class="music-categories" id="musicCategories">
              <button class="category-btn active" data-category="all" title="全部歌曲">🎵</button>
              <button class="category-btn" data-category="favorites" title="我喜欢的音乐">⭐</button>
              <button class="category-btn" data-category="playlists" title="我的歌单">📂</button>
              <button class="category-btn" data-category="local" title="本地音乐">📥</button>
              <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 4px 8px;"></div>
              <button class="category-btn" data-category="virtual_singer" title="Virtual Singer">
                <img src="/unit_logos/vs.webp" alt="VS" />
              </button>
              <button class="category-btn" data-category="leo_need" title="Leo/need">
                <img src="/unit_logos/ln.webp" alt="L/n" />
              </button>
              <button class="category-btn" data-category="more_more_jump" title="MORE MORE JUMP!">
                <img src="/unit_logos/mmj.webp" alt="MMJ" />
              </button>
              <button class="category-btn" data-category="vivid_bad_squad" title="Vivid BAD SQUAD">
                <img src="/unit_logos/vbs.webp" alt="VBS" />
              </button>
              <button class="category-btn" data-category="wonderlands_x_showtime" title="Wonderlands×Showtime">
                <img src="/unit_logos/ws.webp" alt="WxS" />
              </button>
              <button class="category-btn" data-category="25_ji_nightcord_de" title="25时，在Nightcord。">
                <img src="/unit_logos/25ji.webp" alt="25时" />
              </button>
              <button class="category-btn" data-category="other" title="其他">📀</button>
            </div>

            <div class="music-list-container">
              <div class="music-search">
                <input type="text" id="musicSearchInput" placeholder="搜索歌曲..." />
              </div>
              <div class="music-list" id="musicList">
                <div class="loading">加载中...</div>
              </div>
            </div>
          </div>

          <!-- Now Playing -->
          <div class="now-playing-section">
            <div class="album-cover-container">
              <canvas id="visualizerCanvas" width="400" height="400"></canvas>
              <img id="albumCover" src="https://assets.nightcord.de5.net/mysekai/music_record_soundtrack/jacket/jacket_s_soundtrack_1.webp" alt="Album Cover" class="album-cover" crossorigin="anonymous" />
              <div class="cd-animation" id="cdAnimation"></div>
              <div id="trackLoadingSpinner" class="track-loading-spinner hidden">
                <div class="spinner-icon"></div>
              </div>
            </div>
            
            <div class="track-info">
              <div class="track-title" id="trackTitle">选择一首歌曲</div>
              <div class="track-artist" id="trackArtist">-</div>
              <div class="track-vocal" id="trackVocal">-</div>
            </div>

            <!-- Audio Player Controls -->
            <div class="player-progress">
              <span class="time-current" id="currentTime">0:00</span>
              <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1" />
              <span class="time-total" id="totalTime">0:00</span>
            </div>

            <div class="player-controls">
              <button id="prevBtn" class="control-btn" title="上一首">⏮</button>
              <button id="playPauseBtn" class="control-btn play-btn" title="播放/暂停">▶️</button>
              <button id="nextBtn" class="control-btn" title="下一首">⏭</button>
              <button id="shuffleBtn" class="control-btn" title="随机播放">🔀</button>
              <button id="repeatBtn" class="control-btn" title="循环播放">🔁</button>
            </div>

            <div class="volume-control">
              <span>🔊</span>
              <input type="range" id="cdVolumeSlider" min="0" max="0.5" step="0.01" value="0.1" />
            </div>
          </div>
        </div>

        <!-- Hidden Audio Element -->
        <audio id="cdAudioPlayer" preload="metadata"></audio>
      </div>

      <!-- Settings Panel (Expanded) -->
      <div id="settingsPanel" class="hidden expanded-panel">
        <div class="settings-header">
          <span>控制中心</span>
          <div class="header-controls">
            <button id="settingsCloseBtn" class="close-btn" title="关闭">✕</button>
          </div>
        </div>
        <div class="settings-body-layout">
          <!-- Sidebar -->
          <div class="settings-sidebar">
            <button class="sidebar-btn active" data-tab="home">
              <span class="icon">🏠</span> <span class="label">首页</span>
            </button>
            <button class="sidebar-btn" data-tab="sync">
              <span class="icon">☁️</span> <span class="label">数据同步</span>
            </button>
            <button class="sidebar-btn" data-tab="stats">
              <span class="icon">📊</span> <span class="label">专注统计</span>
            </button>
            <button class="sidebar-btn" data-tab="achievements">
              <span class="icon">🏆</span> <span class="label">成就系统</span>
            </button>
            <button class="sidebar-btn" data-tab="about">
              <span class="icon">ℹ️</span> <span class="label">关于</span>
            </button>
          </div>

          <!-- Content Area -->
          <div class="settings-content">
            <!-- Home Tab -->
            <div class="tab-content active" id="tab-home">
              <div class="home-welcome-section">
                <h2 id="greetingText">晚上好，</h2>
                <div class="user-nickname-container">
                  <span id="userNickname" class="nickname-text">「世界」的居民</span>
                  <button id="editNicknameBtn" class="icon-btn" title="修改昵称">✏️</button>
                </div>
              </div>
              
              <div class="home-stats-summary">
                <div class="summary-card">
                  <div class="summary-icon">🔥</div>
                  <div class="summary-text" id="streakSummary">你已与 25时 共同度过了 1 天的时光</div>
                </div>
                <div class="summary-card">
                  <div class="summary-icon">⏳</div>
                  <div class="summary-text" id="timeSummary">累计专注 0 小时，继续加油！</div>
                </div>
              </div>

              <div class="home-tips-card">
                <div class="tips-header">
                  <span class="tips-icon">💡</span>
                  <span>每日贴士</span>
                </div>
                <p id="randomTipText" class="tips-content">休息也是工作的一部分哦。</p>
              </div>
            </div>

            <!-- Sync Tab -->
            <div class="tab-content" id="tab-sync">
              <div class="empty-state">
                <div class="empty-icon">☁️</div>
                <h3>云端同步</h3>
                <p>登录以同步您的专注时长、成就和偏好设置。</p>
                <button class="primary-btn">登录 / 注册</button>
              </div>
            </div>

            <!-- Stats Tab -->
            <div class="tab-content" id="tab-stats">
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-value">0</div>
                  <div class="stat-label">今日专注 (分钟)</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value">0</div>
                  <div class="stat-label">累计专注 (小时)</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value">0</div>
                  <div class="stat-label">完成番茄钟</div>
                </div>
              </div>
              <div class="settings-section">
                <h3>近期活动</h3>
                <div class="activity-list">
                  <div class="activity-item">暂无记录</div>
                </div>
              </div>
            </div>

            <!-- Achievements Tab -->
            <div class="tab-content" id="tab-achievements">
              <div class="achievements-list"></div>
            </div>

            <!-- About Tab -->
            <div class="tab-content" id="tab-about">
              <div class="about-header">
                <div class="about-logo"><svg width="48" height="48" viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M13,10.69v2.72H10.23V10.69Zm3,0v2.69h2.69V10.72ZM23.29,12A11.31,11.31,0,1,1,12,.67,11.31,11.31,0,0,1,23.29,12Zm-.18.07a8.87,8.87,0,1,0-8.87,8.86A8.87,8.87,0,0,0,23.11,12.05Z"
                    fill="white"></path>
                </svg></div>
                <h3>『25时、Nightcord见。』成员们的 24 小时工作日常</h3>
                <p class="version" id="appVersion">Loading...</p>
              </div>
              <div class="settings-section">
                <p class="about-desc">
                  沉浸式作业陪伴工具，提供番茄钟、CD 播放器、世界时钟与音频可视化等实用功能。
                </p>
                <div class="links-row">
                  <a href="https://github.com/bili-47177171806/25ji-sagyo" class="link-btn" target="_blank">GitHub</a>
                  <a href="https://space.bilibili.com/3546904856103196" class="link-btn" target="_blank">Bilibili</a>
                  <a href="https://afdian.com/a/1806P" class="link-btn" target="_blank">爱发电</a>
                  <a href="https://github.com/bili-47177171806/25ji-sagyo/issues/new" class="link-btn" target="_blank">反馈问题</a>
                </div>
              </div>
              <div class="settings-section">
                <div class="section-title">📜 法律条款</div>
                <div class="legal-links-row">
                  <a href="./docs.html?file=TERMS_OF_SERVICE.md" target="_blank" class="legal-link-btn">用户协议</a>
                  <a href="./docs.html?file=PRIVACY_POLICY.md" target="_blank" class="legal-link-btn">隐私政策</a>
                  <a href="./docs.html?file=COPYRIGHT.md" target="_blank" class="legal-link-btn">版权声明</a>
                  <a href="./docs.html?file=LICENSE" target="_blank" class="legal-link-btn">开源许可</a>
                </div>
              </div>
              <div class="settings-section">
                <div class="legal-text">
                  <p><strong>免责声明 / Disclaimer</strong></p>
                  <p>本项目（25ji-sagyo）为非官方粉丝作品（Fan Art），与 SEGA、Colorful Palette 或 Crypton Future Media 无任何关联。</p>
                  <p>本项目中使用的所有游戏素材（包括但不限于视频、音频、图像、角色设计、剧本等）的版权均归 <strong>© SEGA</strong>、<strong>© Colorful Palette Inc.</strong> 及 <strong>© Crypton Future Media, INC.</strong> 所有。</p>
                  <p>本项目仅供学习、研究及个人欣赏使用，<strong>严禁用于任何形式的商业用途或营利活动</strong>。开发者不对因使用本项目而产生的任何直接或间接损失承担责任。</p>
                  <p>如权利方认为本项目侵犯了您的权益，请联系开发者，我们将立即采取措施进行处理。</p>
                  <p style="margin-top: 12px; font-size: 0.85em; opacity: 0.8;">使用本网站即表示您已阅读并同意上述条款。</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Orientation Warning -->
      <div id="orientation-warning">
        <div class="warning-content">
          <div class="phone-icon">📱</div>
          <p>为了更好的体验，请使用横屏浏览</p>
        </div>
      </div>
  </div>

  <script>
  // Default sources - replace or override with query params ?p1=...&p2=...&p3=...
  const DEFAULT_SOURCES = {
    // p1: 'https://REDACTED/sagyo/p01.mp4',
    // p2: 'https://REDACTED/sagyo/p02.mp4',
    // p3: 'https://REDACTED/sagyo/p03.mp4',
    // p4: 'https://REDACTED/sagyo/p04.mp4',
    // p5: 'https://REDACTED/sagyo/p05.mp4',
    // p6: 'https://REDACTED/sagyo/p06.mp4',
    m3u8: 'https://assets.nightcord.de5.net/sagyo/index.m3u8'
  };

  function parseSourcesFromURL() {
    const url = new URL(window.location.href);
    const s = { ...DEFAULT_SOURCES };
    ['p1','p2','p3'].forEach(k => {
      if (url.searchParams.get(k)) s[k] = url.searchParams.get(k);
    });
    return s;
  }

  // make sources globally available to script.js
  window.TIME_SYNC_SOURCES = parseSourcesFromURL();
  </script>

  <!-- 工具模块 -->
  <script src="js/utils/helpers.js"></script>
  <script src="js/utils/storage.js"></script>
  <script src="js/utils/asset-loader.js"></script>
  
  <!-- 数据模块 -->
  <script src="js/data/broadcast-messages.js"></script>
  
  <!-- 功能模块 -->
  <script src="js/features/achievements.js"></script>
  <script src="js/features/live-status.js"></script>
  
  <!-- 组件模块 -->
  <script src="js/components/pomodoro.js"></script>
  <script src="js/components/world-clock.js"></script>
  <script src="js/components/settings-panel.js"></script>
  
  <!-- CD 播放器模块 -->
  <script type="module" src="js/cd-player/index.js"></script>
  
  <!-- 核心模块 -->
  <script src="js/core/video-player.js"></script>
</body>
</html>
