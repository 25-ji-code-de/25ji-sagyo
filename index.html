<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" id="viewportMeta" content="width=device-width, initial-scale=1">
  <title>『25时、Nightcord见。』成员们的 24 小时工作日常</title>
  <meta name="description" content="『25时、Nightcord见。』成员们的 24 小时工作日常 — 沉浸式作业陪伴：番茄钟、CD 播放器、世界时钟与音频可视化等实用工具。" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <video id="video" autoplay muted playsinline preload="metadata" crossorigin="anonymous"></video>
      <div id="overlay">
        <div id="info">
          Time (<span id="tzLabel">Local</span>): <span id="localTime">--:--:--</span>
        </div>

        <div id="controls" role="toolbar" aria-label="Video controls">
          <button id="muteBtn" aria-pressed="true" title="Mute / Unmute">🔊</button>
          <input id="volumeSlider" type="range" min="0" max="1" step="0.05" value="1" aria-label="Volume" />
          <button id="audioProcessBtn" aria-pressed="false" title="音频处理（限幅+降低人声）">🎚️</button>
          <button id="fullscreenBtn" title="Fullscreen">Fullscreen</button>
          <button id="tzToggleBtn" title="Toggle timezone">Toggle TZ</button>
          <button id="pomodoroBtn" title="Pomodoro Timer">🍅</button>
          <button id="cdPlayerBtn" title="CD Player">💿</button>
        </div>

        <!-- Pomodoro Timer Panel -->
        <div id="pomodoroPanel" class="hidden">
          <div class="pomodoro-header">
            <span>番茄钟 & 世界时钟</span>
            <div class="header-controls">
              <button id="toggleClockWidget" class="toggle-btn" title="显示/隐藏时钟">🕐</button>
              <button id="pomodoroCloseBtn" class="close-btn" title="关闭">✕</button>
            </div>
          </div>
          
          <!-- Main Content: Left-Right Layout -->
          <div class="pomodoro-main-content">
            <!-- Left Side: World Clock Section -->
            <div class="world-clock-section" id="worldClockSection">
              <div class="clock-item main-clock">
                <div class="clock-label">本地时间</div>
                <div class="clock-time-large">
                  <span class="time-hours" id="localHours">00</span>
                  <span class="time-separator">:</span>
                  <span class="time-minutes" id="localMinutes">00</span>
                  <span class="time-separator">:</span>
                  <span class="time-seconds" id="localSeconds">00</span>
                  <span class="time-milliseconds" id="localMilliseconds">.000</span>
                </div>
                <div class="clock-date" id="localDate">2025年12月7日 星期六</div>
              </div>
              
              <div class="world-clocks-grid">
                <div class="clock-item-small">
                  <select class="clock-select" id="clock1Select" title="选择时区"></select>
                  <div class="clock-time-small" id="clock1Container">
                    <span class="time-hms" id="clock1Time">00:00:00</span>
                  </div>
                </div>
                <div class="clock-item-small">
                  <select class="clock-select" id="clock2Select" title="选择时区"></select>
                  <div class="clock-time-small" id="clock2Container">
                    <span class="time-hms" id="clock2Time">00:00:00</span>
                  </div>
                </div>
                <div class="clock-item-small">
                  <select class="clock-select" id="clock3Select" title="选择时区"></select>
                  <div class="clock-time-small" id="clock3Container">
                    <span class="time-hms" id="clock3Time">00:00:00</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Side: Pomodoro Timer -->
            <div class="pomodoro-body">
              <div id="pomodoroDisplay" class="pomodoro-display">25:00</div>
              <div class="pomodoro-status">准备工作</div>
              <div class="pomodoro-controls">
                <button id="pomodoroStartBtn" class="pomodoro-btn primary">开始</button>
                <button id="pomodoroPauseBtn" class="pomodoro-btn" disabled>暂停</button>
                <button id="pomodoroResetBtn" class="pomodoro-btn">重置</button>
              </div>
              <div class="pomodoro-settings">
                <div class="setting-item">
                  <label>工作时长 (分钟):</label>
                  <input type="number" id="workDuration" min="1" max="60" value="25" />
                </div>
                <div class="setting-item">
                  <label>短休息 (分钟):</label>
                  <input type="number" id="shortBreak" min="1" max="30" value="5" />
                </div>
                <div class="setting-item">
                  <label>长休息 (分钟):</label>
                  <input type="number" id="longBreak" min="1" max="60" value="15" />
                </div>
                <div class="setting-item">
                  <label>工作轮次:</label>
                  <span id="pomodoroRound">0 / 4</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CD Player Panel -->
      <div id="cdPlayerPanel" class="hidden">
        <div class="cd-player-header">
          <span>🎵 SEKAI 留声机</span>
          <div class="header-controls">
            <button id="toggleVisualization" class="toggle-btn" title="显示/隐藏音频可视化">🌀</button>
            <button id="cdPlayerCloseBtn" class="close-btn" title="关闭">✕</button>
          </div>
        </div>
        
        <div class="cd-player-body">
          <!-- Music List -->
          <div class="music-list-section">
            <!-- Category Sidebar -->
            <div class="music-categories" id="musicCategories">
              <button class="category-btn active" data-category="all" title="全部歌曲">🎵</button>
              <button class="category-btn" data-category="favorites" title="我喜欢的音乐">⭐</button>
              <button class="category-btn" data-category="playlists" title="我的歌单">📂</button>
              <button class="category-btn" data-category="local" title="本地音乐">📥</button>
              <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 4px 8px;"></div>
              <button class="category-btn" data-category="virtual_singer" title="Virtual Singer">
                <img src="/unit_logos/vs.webp" alt="VS" />
              </button>
              <button class="category-btn" data-category="leo_need" title="Leo/need">
                <img src="/unit_logos/ln.webp" alt="L/n" />
              </button>
              <button class="category-btn" data-category="more_more_jump" title="MORE MORE JUMP!">
                <img src="/unit_logos/mmj.webp" alt="MMJ" />
              </button>
              <button class="category-btn" data-category="vivid_bad_squad" title="Vivid BAD SQUAD">
                <img src="/unit_logos/vbs.webp" alt="VBS" />
              </button>
              <button class="category-btn" data-category="wonderlands_x_showtime" title="Wonderlands×Showtime">
                <img src="/unit_logos/ws.webp" alt="WxS" />
              </button>
              <button class="category-btn" data-category="25_ji_nightcord_de" title="25时，在Nightcord。">
                <img src="/unit_logos/25ji.webp" alt="25时" />
              </button>
              <button class="category-btn" data-category="other" title="其他">📀</button>
            </div>

            <div class="music-list-container">
              <div class="music-search">
                <input type="text" id="musicSearchInput" placeholder="搜索歌曲..." />
              </div>
              <div class="music-list" id="musicList">
                <div class="loading">加载中...</div>
              </div>
            </div>
          </div>

          <!-- Now Playing -->
          <div class="now-playing-section">
            <div class="album-cover-container">
              <canvas id="visualizerCanvas" width="400" height="400"></canvas>
              <img id="albumCover" src="https://assets.nightcord.de5.net/mysekai/music_record_soundtrack/jacket/jacket_s_soundtrack_1.png" alt="Album Cover" class="album-cover" crossorigin="anonymous" />
              <div class="cd-animation" id="cdAnimation"></div>
              <div id="trackLoadingSpinner" class="track-loading-spinner hidden">
                <div class="spinner-icon"></div>
              </div>
            </div>
            
            <div class="track-info">
              <div class="track-title" id="trackTitle">选择一首歌曲</div>
              <div class="track-artist" id="trackArtist">-</div>
              <div class="track-vocal" id="trackVocal">-</div>
            </div>

            <!-- Audio Player Controls -->
            <div class="player-progress">
              <span class="time-current" id="currentTime">0:00</span>
              <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1" />
              <span class="time-total" id="totalTime">0:00</span>
            </div>

            <div class="player-controls">
              <button id="prevBtn" class="control-btn" title="上一首">⏮</button>
              <button id="playPauseBtn" class="control-btn play-btn" title="播放/暂停">▶️</button>
              <button id="nextBtn" class="control-btn" title="下一首">⏭</button>
              <button id="shuffleBtn" class="control-btn" title="随机播放">🔀</button>
              <button id="repeatBtn" class="control-btn" title="循环播放">🔁</button>
            </div>

            <div class="volume-control">
              <span>🔊</span>
              <input type="range" id="cdVolumeSlider" min="0" max="1" step="0.01" value="0.7" />
            </div>
          </div>
        </div>

        <!-- Hidden Audio Element -->
        <audio id="cdAudioPlayer" preload="metadata"></audio>
      </div>

      <!-- Orientation Warning -->
      <div id="orientation-warning">
        <div class="warning-content">
          <div class="phone-icon">📱</div>
          <p>为了更好的体验，请使用横屏浏览</p>
        </div>
      </div>
  </div>

  <script>
  // Default sources - replace or override with query params ?p1=...&p2=...&p3=...
  const DEFAULT_SOURCES = {
    // p1: 'https://REDACTED/sagyo/p01.mp4',
    // p2: 'https://REDACTED/sagyo/p02.mp4',
    // p3: 'https://REDACTED/sagyo/p03.mp4',
    // p4: 'https://REDACTED/sagyo/p04.mp4',
    // p5: 'https://REDACTED/sagyo/p05.mp4',
    // p6: 'https://REDACTED/sagyo/p06.mp4',
    m3u8: 'https://assets.nightcord.de5.net/sagyo/index.m3u8'
  };

  function parseSourcesFromURL() {
    const url = new URL(window.location.href);
    const s = { ...DEFAULT_SOURCES };
    ['p1','p2','p3'].forEach(k => {
      if (url.searchParams.get(k)) s[k] = url.searchParams.get(k);
    });
    return s;
  }

  // make sources globally available to script.js
  window.TIME_SYNC_SOURCES = parseSourcesFromURL();
  </script>

  <script src="script.js"></script>
</body>
</html>
